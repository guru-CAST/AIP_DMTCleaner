# AIP_DMTCleaner
Over time, the CAST DLIVERY folder grows in size, taking up vast amounts of disk space, due to many version of the application source code delivered. DMT Cleaner is designed to pruge older versions of delivered source code that have already been analyzed and are no longer needed.

## Prerequisites
The script is written in Python. Ensure that you have Python __3.6__ or above installed. 
It uses the following Python packages. Ensure these are installed using the Python __PIP__ command. PIP may install additional dependent packages, as needed, if a dependent package is not already installed.

- requests
- PyYAML

Refer to [Installing Python Modules](https://docs.python.org/3.6/installing/) webpage for more information on how to install Python modules.

## Initial setup
1. Copy the files and folder into a folder named AIP_DMTCleaner.
2. Create a blank folder named __logs__ in the newly created folder.
3. Edit the ``AIPCleaner.YAML`` file in the __resources__ folder and update the settings as appropriate to your CAST environment. See below for details.

### YAML file settings
The YAML is configured with the following default setting:
```
Dashboard:
  URL: http://localhost:8090/CAST-Health-Engineering/rest
  username: admin
  password: cast
  domain: AAD
 
CMS:
  delivery_folder: D:\CAST\CASTMS\Delivery
  pmx_file: D:\CAST\CONFIG\cast-ms.connectionProfiles.pmx
 
other_settings:
  log_folder: d:\cast\logs\AIPCleaner
  cast_home: d:\CAST\8.3
```
The script retrieves application information from the Health Dashboard (__HD__). Update the __Dashboard__ section in the YAML file to point to the appropriate HD URL and credentials. Ensure that the URL ends with __/rest__. Typically, the DOMAIN entry is AAD, but if this was changed in your environment, update it to the appropriate value.

__NOTE__: Ensure that the id being used for connecting to AAD has admin rights to the __HD__ dashboard.

The setiings in the __CMS__ section of the YAML file point to the CAST __DELIVERY__ folder and the CAST-MS connection profile file. Update these setting to point to the delivery folder and the connection profile file.

Update the __log_folder__ setting in the __other_settings__ section to point to the log folder. The log files generated by the script will be placed in this folder. Use the __cast_home__ setting to point to the CAST __installation__ folder. The script uses this setting to locate the __CLI__ command that performs the delete action.

## Invoking DMT Cleaner
The script can be invoked from the command prompt as follows:

```
python AIP_DMTCleaner.py [-drop] [-app application_name]
```
The __-drop__ and the __-app__ arguments are optional.
Providing the __-drop__ argument informs the script that the deliveries need to dropped. When this argument is not supplied, the script works as usual, except, the deliveries are not dropped - it only prints informational messages, which is useful as a preview feature, which can be used to determine which deliveries will be potentially dropped.

The __-app__ argument should be used to target a specific application. Else, the script processes all applications.